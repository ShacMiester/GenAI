<div class="sidebar" [class.open]="isOpen()">
  <div class="flex-col h-100 sidebar-content" [class.align-items__center]="!isOpen()">
    <div class="header" [class.w-100]="!isOpen()">
      <img [src]="isOpen() ? 'images/sidebar/client-logo.svg' : 'images/sidebar/client-logo-small.svg'" alt=""
        class="logo">
      
      <!-- Mobile closed state: show current route and user -->
      @if (!isOpen()) {
        <div class="mobile-closed-content">
          <div class="current-route-indicator">
            <img [src]="getCurrentRouteIcon()" alt="">
          </div>
          <div class="mobile-user">
            <img src="images/sidebar/user-image.svg" alt="">
          </div>
        </div>
      }
      
      <!-- Mobile open state: show X button -->
      @if (isOpen()) {
        <div class="mobile-close-x" (click)="toggle()"></div>
      }
      
      <div class="toggle-container" (click)="toggle()">
        <img src="images/sidebar/burger-toggle.svg" alt="" [attr.aria-label]="isOpen() ? 'Close menu' : 'Open menu'"
             style="width: 20px; height: 20px;">
      </div>
    </div>
    <div class="sidebar-items-container flex-1">
      @for (item of menuItems(); track item.title) {
      <div class="menu-item">
        <div class="item-main" (click)="item.subItems ? toggleMenuItem(item.title) : navigateTo(item.route)">
          <div class="item-content">
            <img [src]="item.logo" alt="">
            @if (isOpen()) {
            <genai-typography [color]="item.titleColor" [name]="14">{{ item.title }}</genai-typography>
            }
          </div>
          @if (item.subItems) {
          <div class="overlap"></div>
          }
          <div class="item-actions">
            @if (item.action && isOpen()) {
            <img [src]="item.action.icon" alt="" class="action-btn"
              (click)="$event.stopPropagation(); item.action.callback()">
            }
            @if (item.subItems && isOpen()) {
            <img src="images/actions/caretup.svg" alt="" class="caret" [class.flipped]="!isItemExpanded(item.title)">
            }
          </div>
        </div>
        @if (item.subItems && isOpen() && isItemExpanded(item.title)) {
        <div class="sub-items">
          @for (subItem of item.subItems; track subItem.title; let i = $index) {
          <div class="sub-item" [style.--item-index]="i" (click)="navigateTo(subItem.route)">
            <div class="flex gap-10 align-items__center">
              <img [src]="subItem.logo" alt="">
              <genai-typography [color]="subItem.titleColor" [name]="13">{{ subItem.title }}</genai-typography>
            </div>
            @if (subItem.action) {
            <img [src]="subItem.action.icon" alt="" class="action-btn sub-action"
              (click)="$event.stopPropagation(); subItem.action.callback()">
            }
          </div>
          }
        </div>
        }
        @if (item.subItems && !isOpen()) {
        <div class="hover-menu">
          <div class="menu-items-header">
            {{item.title}}
          </div>
          <div class="menu-header">
            <img [src]="item.logo" alt="">
            <span>{{ item.title }}</span>
          </div>
          <div class="menu-items">
            @for (subItem of item.subItems; track subItem.title) {
            <div class="menu-item" (click)="navigateTo(subItem.route)">
              <img [src]="subItem.logo" alt="">
              <span>{{ subItem.title }}</span>
              @if (subItem.action) {
              <img [src]="subItem.action.icon" alt="" class="action-btn"
                (click)="$event.stopPropagation(); subItem.action.callback()">
              }
            </div>
            }
          </div>
        </div>
        }
      </div>
      }
    </div>
    <div class="footer ph-7 flex gap-7">
      <img src="images/sidebar/user-image.svg" alt="">
      @if(isOpen()) {
      <div class="flex-col gap-2">
        <genai-typography [name]="14" color="text-prim" [weight]="500">John Doe</genai-typography>
        <genai-typography color="text-prim" [weight]="400">Admin</genai-typography>
      </div>
      }
    </div>
  </div>
</div>